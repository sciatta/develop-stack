
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Flume数据采集 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="Flume安装部署.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"sciatta","repo":"develop-stack","type":"star","count":true,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../../">
            
                <a href="../../../../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Language
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    Java
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" >
            
                <span>
            
                    
                    JVM
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" data-path="../../../language/java/jvm/JVM核心技术.html">
            
                <a href="../../../language/java/jvm/JVM核心技术.html">
            
                    
                    JVM核心技术
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.2" data-path="../../../language/java/jvm/JDK工具.html">
            
                <a href="../../../language/java/jvm/JDK工具.html">
            
                    
                    JDK工具
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" >
            
                <span>
            
                    
                    IO
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1" data-path="../../../language/java/io/NIO模型与Netty.html">
            
                <a href="../../../language/java/io/NIO模型与Netty.html">
            
                    
                    NIO模型与Netty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" >
            
                <span>
            
                    
                    Concurrency
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.3.1" data-path="../../../language/java/concurrency/并发编程.html">
            
                <a href="../../../language/java/concurrency/并发编程.html">
            
                    
                    并发编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" >
            
                <span>
            
                    
                    Algorithm
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.4.1" data-path="../../../language/java/algorithm/数据结构和算法.html">
            
                <a href="../../../language/java/algorithm/数据结构和算法.html">
            
                    
                    数据结构和算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" >
            
                <span>
            
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.5.1" data-path="../../../language/java/spring/SpringCore核心功能.html">
            
                <a href="../../../language/java/spring/SpringCore核心功能.html">
            
                    
                    SpringCore核心功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5.2" data-path="../../../language/java/spring/SpringBoot核心功能.html">
            
                <a href="../../../language/java/spring/SpringBoot核心功能.html">
            
                    
                    SpringBoot核心功能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    scala
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Bigdata
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Hadoop
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" >
            
                <span>
            
                    
                    HDFS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.1" data-path="../../hadoop/hdfs/HDFS核心功能原理.html">
            
                <a href="../../hadoop/hdfs/HDFS核心功能原理.html">
            
                    
                    HDFS核心功能原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2" data-path="../../hadoop/hdfs/HDFS命令.html">
            
                <a href="../../hadoop/hdfs/HDFS命令.html">
            
                    
                    HDFS命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.3" data-path="../../hadoop/hdfs/HDFS源码分析.html">
            
                <a href="../../hadoop/hdfs/HDFS源码分析.html">
            
                    
                    HDFS源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" >
            
                <span>
            
                    
                    MapReduce
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.2.1" data-path="../../hadoop/mapreduce/MapReduce工作原理.html">
            
                <a href="../../hadoop/mapreduce/MapReduce工作原理.html">
            
                    
                    MapReduce工作原理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" >
            
                <span>
            
                    
                    YARN
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.3.1" data-path="../../hadoop/yarn/YARN架构.html">
            
                <a href="../../hadoop/yarn/YARN架构.html">
            
                    
                    YARN架构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../../hadoop/Hadoop集群安装部署.html">
            
                <a href="../../hadoop/Hadoop集群安装部署.html">
            
                    
                    Hadoop集群安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../../hadoop/Hadoop HA集群安装部署.html">
            
                <a href="../../hadoop/Hadoop HA集群安装部署.html">
            
                    
                    Hadoop HA集群安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../../hadoop/Hadoop企业级调优.html">
            
                <a href="../../hadoop/Hadoop企业级调优.html">
            
                    
                    Hadoop企业级调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    ZooKeeper
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../../zookeeper/ZooKeeper集群安装部署.html">
            
                <a href="../../zookeeper/ZooKeeper集群安装部署.html">
            
                    
                    ZooKeeper集群安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../../zookeeper/ZooKeeper分布式协调框架.html">
            
                <a href="../../zookeeper/ZooKeeper分布式协调框架.html">
            
                    
                    ZooKeeper分布式协调框架
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Hive
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../../hive/Hive安装部署.html">
            
                <a href="../../hive/Hive安装部署.html">
            
                    
                    Hive安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../../hive/大数据分析利器之Hive.html">
            
                <a href="../../hive/大数据分析利器之Hive.html">
            
                    
                    大数据分析利器之Hive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../../hive/Hive调优.html">
            
                <a href="../../hive/Hive调优.html">
            
                    
                    Hive调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    HBase
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../../hbase/HBase集群安装部署.html">
            
                <a href="../../hbase/HBase集群安装部署.html">
            
                    
                    HBase集群安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../../hbase/大数据数据库之HBase.html">
            
                <a href="../../hbase/大数据数据库之HBase.html">
            
                    
                    大数据数据库之HBase
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" >
            
                <span>
            
                    
                    AuxiliaryFramework
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" >
            
                <span>
            
                    
                    Flume
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1.1" data-path="Flume安装部署.html">
            
                <a href="Flume安装部署.html">
            
                    
                    Flume安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.5.1.2" data-path="Flume数据采集.html">
            
                <a href="Flume数据采集.html">
            
                    
                    Flume数据采集
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" >
            
                <span>
            
                    
                    Sqoop
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.2.1" data-path="../sqoop/Sqoop安装部署.html">
            
                <a href="../sqoop/Sqoop安装部署.html">
            
                    
                    Sqoop安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2.2" data-path="../sqoop/Sqoop数据迁移.html">
            
                <a href="../sqoop/Sqoop数据迁移.html">
            
                    
                    Sqoop数据迁移
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5.3" >
            
                <span>
            
                    
                    Azkaban
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.3.1" data-path="../azkaban/Azkaban安装部署.html">
            
                <a href="../azkaban/Azkaban安装部署.html">
            
                    
                    Azkaban安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.3.2" data-path="../azkaban/Azkaban工作流调度器.html">
            
                <a href="../azkaban/Azkaban工作流调度器.html">
            
                    
                    Azkaban工作流调度器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" >
            
                <span>
            
                    
                    Kafka
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="../../kafka/Kafka集群安装部署.html">
            
                <a href="../../kafka/Kafka集群安装部署.html">
            
                    
                    Kafka集群安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.2" data-path="../../kafka/Kafka监控工具.html">
            
                <a href="../../kafka/Kafka监控工具.html">
            
                    
                    Kafka监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.3" data-path="../../kafka/Kafka分布式消息流平台.html">
            
                <a href="../../kafka/Kafka分布式消息流平台.html">
            
                    
                    Kafka分布式消息流平台
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7" >
            
                <span>
            
                    
                    Spark
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.1" >
            
                <span>
            
                    
                    SparkCore
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.1.1" data-path="../../spark/sparkcore/SparkCore核心功能.html">
            
                <a href="../../spark/sparkcore/SparkCore核心功能.html">
            
                    
                    SparkCore核心功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.1.2" data-path="../../spark/sparkcore/Spark调优.html">
            
                <a href="../../spark/sparkcore/Spark调优.html">
            
                    
                    Spark调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7.2" >
            
                <span>
            
                    
                    SparkSQL
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.2.1" data-path="../../spark/sparksql/SparkSQL核心功能.html">
            
                <a href="../../spark/sparksql/SparkSQL核心功能.html">
            
                    
                    SparkSQL核心功能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7.3" data-path="../../spark/Spark集群安装部署.html">
            
                <a href="../../spark/Spark集群安装部署.html">
            
                    
                    Spark集群安装部署
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Database
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    MySQL
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../../../database/mysql/CentOS7安装MySQL5.7.html">
            
                <a href="../../../database/mysql/CentOS7安装MySQL5.7.html">
            
                    
                    CentOS7安装MySQL5.7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../../../database/mysql/SQL经典50题.html">
            
                <a href="../../../database/mysql/SQL经典50题.html">
            
                    
                    SQL经典50题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    Redis
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../../database/redis/Redis核心功能.html">
            
                <a href="../../../database/redis/Redis核心功能.html">
            
                    
                    Redis核心功能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    VersionControl
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    Git
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../../../versioncontrol/git/GitBook&GitHub&Typora最佳实践.html">
            
                <a href="../../../versioncontrol/git/GitBook&GitHub&Typora最佳实践.html">
            
                    
                    GitBook&GitHub&Typora最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../../../versioncontrol/git/Git命令.html">
            
                <a href="../../../versioncontrol/git/Git命令.html">
            
                    
                    Git命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../../../versioncontrol/git/GitHub日常使用.html">
            
                <a href="../../../versioncontrol/git/GitHub日常使用.html">
            
                    
                    GitHub日常使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Virtualization
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <span>
            
                    
                    VMware
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../../../virtualization/vmware/VMware系统安装.html">
            
                <a href="../../../virtualization/vmware/VMware系统安装.html">
            
                    
                    VMware系统安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" >
            
                <span>
            
                    
                    Docker
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../../../virtualization/docker/Docker架构.html">
            
                <a href="../../../virtualization/docker/Docker架构.html">
            
                    
                    Docker架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="../../../virtualization/docker/Docker命令.html">
            
                <a href="../../../virtualization/docker/Docker命令.html">
            
                    
                    Docker命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="../../../virtualization/docker/Dockerfile参考.html">
            
                <a href="../../../virtualization/docker/Dockerfile参考.html">
            
                    
                    Dockerfile参考
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    OS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" >
            
                <span>
            
                    
                    Linux
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1.1" data-path="../../../os/linux/Linux命令.html">
            
                <a href="../../../os/linux/Linux命令.html">
            
                    
                    Linux命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.1.2" data-path="../../../os/linux/iTerm的使用.html">
            
                <a href="../../../os/linux/iTerm的使用.html">
            
                    
                    iTerm的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    IDE
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" >
            
                <span>
            
                    
                    IntelliJ IDEA
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../../../ide/intellijidea/IDEA配置开发环境.html">
            
                <a href="../../../ide/intellijidea/IDEA配置开发环境.html">
            
                    
                    IDEA配置开发环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../../../ide/intellijidea/IDEA创建GitHub项目.html">
            
                <a href="../../../ide/intellijidea/IDEA创建GitHub项目.html">
            
                    
                    IDEA创建GitHub项目
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    CloudPlatform
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" >
            
                <span>
            
                    
                    vultr
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../../../cloudplatform/vultr/Shadowsocks服务端配置.html">
            
                <a href="../../../cloudplatform/vultr/Shadowsocks服务端配置.html">
            
                    
                    Shadowsocks服务端配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    [后记]
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../.." >Flume数据采集</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>1. </b>&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6982;&#x8FF0;"><b>1.1. </b>&#x6982;&#x8FF0;</a></li><li><span class="title-icon "></span><a href="#&#x8FD0;&#x884C;&#x673A;&#x5236;"><b>1.2. </b>&#x8FD0;&#x884C;&#x673A;&#x5236;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5B9E;&#x6218;"><b>2. </b>&#x5B9E;&#x6218;</a></li><ul><li><span class="title-icon "></span><a href="#&#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;"><b>2.1. </b>&#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;</a></li><ul><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;"><b>2.1.1. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;"><b>2.1.2. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;"><b>2.1.3. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;hdfs"><b>2.2. </b>&#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;HDFS</a></li><ul><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_1"><b>2.2.1. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_1"><b>2.2.2. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_1"><b>2.2.3. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;hdfs"><b>2.3. </b>&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;HDFS</a></li><ul><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_2"><b>2.3.1. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_2"><b>2.3.2. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_2"><b>2.3.3. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x65AD;&#x70B9;&#x7EED;&#x4F20;"><b>2.4. </b>&#x65AD;&#x70B9;&#x7EED;&#x4F20;</a></li><ul><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_3"><b>2.4.1. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_3"><b>2.4.2. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_3"><b>2.4.3. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x7EA7;&#x8054;agent"><b>2.5. </b>&#x7EA7;&#x8054;Agent</a></li><ul><li><span class="title-icon "></span><a href="#&#x5B89;&#x88C5;"><b>2.5.1. </b>&#x5B89;&#x88C5;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_4"><b>2.5.2. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_4"><b>2.5.3. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_4"><b>2.5.4. </b>&#x6D4B;&#x8BD5;</a></li></ul></ul><li><span class="title-icon "></span><a href="#failover-&#x6545;&#x969C;&#x8F6C;&#x79FB;"><b>3. </b>failover &#x6545;&#x969C;&#x8F6C;&#x79FB;</a></li><ul><li><span class="title-icon "></span><a href="#&#x89C4;&#x5212;"><b>3.1. </b>&#x89C4;&#x5212;</a></li><li><span class="title-icon "></span><a href="#&#x5B89;&#x88C5;_1"><b>3.2. </b>&#x5B89;&#x88C5;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_5"><b>3.3. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_5"><b>3.4. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_5"><b>3.5. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#load-balance-&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><b>4. </b>load balance &#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><ul><li><span class="title-icon "></span><a href="#&#x89C4;&#x5212;_1"><b>4.1. </b>&#x89C4;&#x5212;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_6"><b>4.2. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_6"><b>4.3. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_6"><b>4.4. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;"><b>5. </b>&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;</a></li><ul><li><span class="title-icon "></span><a href="#&#x81EA;&#x5B9A;&#x4E49;interceptor"><b>5.1. </b>&#x81EA;&#x5B9A;&#x4E49;Interceptor</a></li><ul><li><span class="title-icon "></span><a href="#&#x9700;&#x6C42;"><b>5.1.1. </b>&#x9700;&#x6C42;</a></li><li><span class="title-icon "></span><a href="#&#x51C6;&#x5907;&#x6570;&#x636E;"><b>5.1.2. </b>&#x51C6;&#x5907;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#&#x5F00;&#x53D1;"><b>5.1.3. </b>&#x5F00;&#x53D1;</a></li><li><span class="title-icon "></span><a href="#&#x4E0A;&#x4F20;jar"><b>5.1.4. </b>&#x4E0A;&#x4F20;jar</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_7"><b>5.1.5. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_7"><b>5.1.6. </b>&#x542F;&#x52A8;</a></li></ul><li><span class="title-icon "></span><a href="#&#x81EA;&#x5B9A;&#x4E49;source"><b>5.2. </b>&#x81EA;&#x5B9A;&#x4E49;Source</a></li><ul><li><span class="title-icon "></span><a href="#&#x9700;&#x6C42;_1"><b>5.2.1. </b>&#x9700;&#x6C42;</a></li><li><span class="title-icon "></span><a href="#&#x51C6;&#x5907;&#x6570;&#x636E;_1"><b>5.2.2. </b>&#x51C6;&#x5907;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#&#x5F00;&#x53D1;_1"><b>5.2.3. </b>&#x5F00;&#x53D1;</a></li><li><span class="title-icon "></span><a href="#&#x4E0A;&#x4F20;jar_1"><b>5.2.4. </b>&#x4E0A;&#x4F20;jar</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_8"><b>5.2.5. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_8"><b>5.2.6. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_7"><b>5.2.7. </b>&#x6D4B;&#x8BD5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x81EA;&#x5B9A;&#x4E49;sink"><b>5.3. </b>&#x81EA;&#x5B9A;&#x4E49;Sink</a></li><ul><li><span class="title-icon "></span><a href="#&#x9700;&#x6C42;_2"><b>5.3.1. </b>&#x9700;&#x6C42;</a></li><li><span class="title-icon "></span><a href="#&#x51C6;&#x5907;&#x6570;&#x636E;_2"><b>5.3.2. </b>&#x51C6;&#x5907;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#&#x5F00;&#x53D1;_2"><b>5.3.3. </b>&#x5F00;&#x53D1;</a></li><li><span class="title-icon "></span><a href="#&#x4E0A;&#x4F20;jar_2"><b>5.3.4. </b>&#x4E0A;&#x4F20;jar</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;_9"><b>5.3.5. </b>&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;_9"><b>5.3.6. </b>&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;_8"><b>5.3.7. </b>&#x6D4B;&#x8BD5;</a></li></ul></ul></ul></div><a href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h1>
<h2 id="&#x6982;&#x8FF0;"><a name="&#x6982;&#x8FF0;" class="anchor-navigation-ex-anchor" href="#&#x6982;&#x8FF0;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x6982;&#x8FF0;</h2>
<p>Flume &#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x3001;&#x53EF;&#x9760;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;<strong>&#x6D77;&#x91CF;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x3001;&#x805A;&#x5408;&#x548C;&#x4F20;&#x8F93;</strong>&#x7684;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>Flume &#x53EF;&#x4EE5;&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#xFF0C;socket&#x6570;&#x636E;&#x5305;&#x3001;&#x6587;&#x4EF6;&#x3001;&#x6587;&#x4EF6;&#x5939;&#x3001;kafka &#x7B49;&#x5404;&#x79CD;&#x5F62;&#x5F0F;&#x6E90;&#x6570;&#x636E;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x5C06;&#x91C7;&#x96C6;&#x5230;&#x7684;&#x6570;&#x636E;&#xFF08;&#x4E0B;&#x6C89;sink&#xFF09;&#x8F93;&#x51FA;&#x5230;HDFS&#x3001;hbase&#x3001;hive&#x3001;kafka&#x7B49;&#x4F17;&#x591A;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x4E2D;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x7684;&#x91C7;&#x96C6;&#x9700;&#x6C42;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9; Flume &#x7684;&#x7B80;&#x5355;&#x914D;&#x7F6E;&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x3002;Flume &#x9488;&#x5BF9;&#x7279;&#x6B8A;&#x573A;&#x666F;&#x4E5F;&#x5177;&#x5907;&#x826F;&#x597D;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x6269;&#x5C55;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;flume &#x53EF;&#x4EE5;&#x9002;&#x7528;&#x4E8E;&#x5927;&#x90E8;&#x5206;&#x7684;&#x65E5;&#x5E38;<font color="red">&#x6570;&#x636E;&#x91C7;&#x96C6;</font>&#x573A;&#x666F;&#x3002;</p>
<h2 id="&#x8FD0;&#x884C;&#x673A;&#x5236;"><a name="&#x8FD0;&#x884C;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#&#x8FD0;&#x884C;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x8FD0;&#x884C;&#x673A;&#x5236;</h2>
<p>Flume&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x89D2;&#x8272;&#x662F;agent&#xFF0C;flume&#x91C7;&#x96C6;&#x7CFB;&#x7EDF;&#x5C31;&#x662F;&#x7531;&#x4E00;&#x4E2A;&#x4E2A;agent&#x6240;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x5F62;&#x6210;&#x3002;&#x6BCF;&#x4E00;&#x4E2A; agent &#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4F20;&#x9012;&#x5458;&#xFF0C;&#x5185;&#x90E8;&#x6709;&#x4E09;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF1A;</p>
<ul>
<li><p>Source&#xFF1A;&#x91C7;&#x96C6;&#x7EC4;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x8DDF;&#x6570;&#x636E;&#x6E90;&#x5BF9;&#x63A5;&#xFF0C;&#x4EE5;&#x83B7;&#x53D6;&#x6570;&#x636E;</p>
</li>
<li><p>Sink&#xFF1A;&#x4E0B;&#x6C89;&#x7EC4;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x5F80;&#x4E0B;&#x4E00;&#x7EA7;agent&#x4F20;&#x9012;&#x6570;&#x636E;&#x6216;&#x8005;&#x5F80;&#x6700;&#x7EC8;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x4F20;&#x9012;&#x6570;&#x636E;</p>
</li>
<li><p>Channel&#xFF1A;&#x4F20;&#x8F93;&#x901A;&#x9053;&#x7EC4;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x4ECE;source&#x5C06;&#x6570;&#x636E;&#x4F20;&#x9012;&#x5230;sink</p>
</li>
</ul>
<p><img src="Flume&#x6570;&#x636E;&#x91C7;&#x96C6;.assets/flume_single_agent.png" alt="flume_single_agent"></p>
<h1 id="&#x5B9E;&#x6218;"><a name="&#x5B9E;&#x6218;" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x6218;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x5B9E;&#x6218;</h1>
<h2 id="&#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;"><a name="&#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;" class="anchor-navigation-ex-anchor" href="#&#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x91C7;&#x96C6;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x6570;&#x636E;&#x5E76;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;</h2>
<h3 id="&#x914D;&#x7F6E;"><a name="&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. &#x914D;&#x7F6E;</h3>
<p>netcat-memory-logger.conf</p>
<pre><code class="lang-properties"># &#x5B9A;&#x4E49;&#x8FD9;&#x4E2A;agent&#x4E2D;&#x5404;&#x7EC4;&#x4EF6;&#x7684;&#x540D;&#x5B57;
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# &#x63CF;&#x8FF0;&#x548C;&#x914D;&#x7F6E;source&#x7EC4;&#x4EF6;&#xFF1A;r1
a1.sources.r1.type = netcat
a1.sources.r1.bind = 192.168.2.102
a1.sources.r1.port = 44444

# &#x63CF;&#x8FF0;&#x548C;&#x914D;&#x7F6E;sink&#x7EC4;&#x4EF6;&#xFF1A;k1
a1.sinks.k1.type = logger

# &#x63CF;&#x8FF0;&#x548C;&#x914D;&#x7F6E;channel&#x7EC4;&#x4EF6;&#xFF0C;&#x6B64;&#x5904;&#x4F7F;&#x7528;&#x662F;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x7684;&#x65B9;&#x5F0F;
a1.channels.c1.type = memory
# &#x9ED8;&#x8BA4;&#x8BE5;&#x901A;&#x9053;&#x4E2D;&#x6700;&#x5927;&#x7684;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x7684;event&#x6570;&#x91CF;
a1.channels.c1.capacity = 1000
# &#x6BCF;&#x6B21;&#x6700;&#x5927;&#x53EF;&#x4EE5;&#x4ECE;source&#x4E2D;&#x62FF;&#x5230;&#x6216;&#x8005;&#x9001;&#x5230;sink&#x4E2D;&#x7684;event&#x6570;&#x91CF;
# &#x6CE8;&#x610F;&#xFF1A;capacity &gt; trasactionCapacity
a1.channels.c1.transactionCapacity = 100

# &#x63CF;&#x8FF0;&#x548C;&#x914D;&#x7F6E;source channel sink&#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x63A5;&#x5173;&#x7CFB;
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<h3 id="&#x542F;&#x52A8;"><a name="&#x542F;&#x52A8;" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2. &#x542F;&#x52A8;</h3>
<pre><code class="lang-bash"><span class="hljs-comment"># -c &#x6307;&#x5B9A;flume&#x81EA;&#x8EAB;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x76EE;&#x5F55;</span>
<span class="hljs-comment"># -f netcat-memory-logger.conf &#x6307;&#x5B9A;&#x63CF;&#x8FF0;&#x7684;&#x91C7;&#x96C6;&#x65B9;&#x6848;</span>
flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> netcat-memory-logger.conf -n a1 -Dflume.root.logger=INFO,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;"><a name="&#x6D4B;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.3. &#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x5B89;&#x88C5;telnet&#x5BA2;&#x6237;&#x7AEF;&#x6A21;&#x62DF;&#x6570;&#x636E;&#x53D1;&#x9001;</span>
sudo yum -y install telnet

<span class="hljs-comment"># &#x6D4B;&#x8BD5;</span>
<span class="hljs-comment"># control+]    &#x56DE;&#x5230;telnet&#x547D;&#x4EE4;&#x7A97;&#x53E3;</span>
<span class="hljs-comment"># quit &#x9000;&#x51FA;</span>
telnet node03 44444
</code></pre>
<h2 id="&#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;hdfs"><a name="&#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;hdfs" class="anchor-navigation-ex-anchor" href="#&#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;hdfs"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x91C7;&#x96C6;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x5230;HDFS</h2>
<h3 id="&#x914D;&#x7F6E;_1"><a name="&#x914D;&#x7F6E;_1" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. &#x914D;&#x7F6E;</h3>
<p>spooldir.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
# &#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x80FD;&#x5411;&#x76D1;&#x63A7;&#x76EE;&#x4E2D;&#x91CD;&#x590D;&#x653E;&#x540C;&#x540D;&#x6587;&#x4EF6;
a1.sources.r1.type = spooldir
a1.sources.r1.spoolDir = /home/hadoop/flumedatas/spooldir
a1.sources.r1.fileHeader = true

# Describe the sink
a1.sinks.k1.type = hdfs
a1.sinks.k1.hdfs.path = hdfs://node01:8020/test/flume/spooldir/files/%y-%m-%d/%H%M/
a1.sinks.k1.hdfs.filePrefix = events-

# ========
# &#x65F6;&#x95F4;&#x6233;&#x662F;&#x5426;&#x9700;&#x8981;&#x56DB;&#x820D;&#x4E94;&#x5165;&#xFF0C;&#x9ED8;&#x8BA4;false&#xFF0C;true&#x5F71;&#x54CD;&#x6240;&#x6709;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#x7684;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;&#xFF0C;&#x9664;&#x4E86;%t
a1.sinks.k1.hdfs.round = true
# &#x65F6;&#x95F4;&#x6233;&#x56DB;&#x820D;&#x4E94;&#x5165;&#x7684;&#x500D;&#x6570;&#xFF0C;&#x5C0F;&#x4E8E;&#x5F53;&#x524D;&#x65F6;&#x95F4;
a1.sinks.k1.hdfs.roundValue = 10
# &#x65F6;&#x95F4;&#x6233;&#x56DB;&#x820D;&#x4E94;&#x5165;&#x7684;&#x5355;&#x4F4D;&#xFF0C;&#x9ED8;&#x8BA4;&#x79D2;
a1.sinks.k1.hdfs.roundUnit = minute
# &#x4EE5;&#x4E0A;&#x4E3A;&#x6BCF;&#x9694;10&#x5206;&#x949F;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;
# ========

# ========
# &#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF08;&#x79D2;&#xFF09;&#xFF0C;&#x9ED8;&#x8BA4;30&#xFF0C;0&#x4E0D;&#x4F1A;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;
# a1.sinks.k1.hdfs.rollInterval = 3
a1.sinks.k1.hdfs.rollInterval = 0
# &#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF08;&#x5B57;&#x8282;&#xFF09;&#xFF0C;&#x9ED8;&#x8BA4;1024&#xFF0C;0&#x4E0D;&#x4F1A;&#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;
# a1.sinks.k1.hdfs.rollSize = 20
a1.sinks.k1.hdfs.rollSize = 0
# &#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;&#x7684;&#x4E8B;&#x4EF6;&#x6570;&#x91CF;&#xFF08;&#x6700;&#x5C0F;&#x4F20;&#x8F93;&#x5355;&#x4F4D;&#xFF09;&#xFF0C;&#x9ED8;&#x8BA4;10&#xFF0C;0&#x4E0D;&#x4F1A;&#x57FA;&#x4E8E;&#x4E8B;&#x4EF6;&#x6570;&#x91CF;&#x6EDA;&#x52A8;&#x6587;&#x4EF6;
# a1.sinks.k1.hdfs.rollCount = 5
a1.sinks.k1.hdfs.rollCount = 0
# ========

# ========
# &#x5237;&#x5199;&#x5230;HDFS&#x524D;&#x7684;&#x4E8B;&#x4EF6;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;100
a1.sinks.k1.hdfs.batchSize = 1
# ========

a1.sinks.k1.hdfs.useLocalTimeStamp = true
# &#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;&#x9ED8;&#x8BA4; SequenceFile&#xFF0C;&#x53EF;&#x7528; DataStream &#x4EE3;&#x66FF;&#xFF0C;&#x4E3A;&#x666E;&#x901A;&#x6587;&#x672C;
a1.sinks.k1.hdfs.fileType = DataStream

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<ul>
<li><p>Source&#xFF1A;spooldir</p>
<ul>
<li>&#x76D1;&#x89C6;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF08;<font color="red">flume&#x90E8;&#x7F72;&#x5230;&#x6570;&#x636E;&#x6E90;&#x4E00;&#x7AEF;</font>&#xFF09;&#xFF0C;<strong>&#x53EA;&#x8981;&#x76EE;&#x5F55;&#x4E2D;&#x51FA;&#x73B0;&#x65B0;&#x6587;&#x4EF6;</strong>&#xFF0C;&#x5C31;&#x4F1A;&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;</li>
</ul>
</li>
<li><p>&#x91C7;&#x96C6;&#x5B8C;&#x6210;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4F1A;&#x88AB;agent&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x540E;&#x7F00;&#xFF1A;COMPLETED</p>
<ul>
<li>HDFS &#x4E0A;&#x7684;&#x6587;&#x4EF6;&#x4EE5; .tmp &#x4F5C;&#x4E3A;&#x540E;&#x7F00;&#xFF0C;&#x5F53; flume agent &#x5173;&#x95ED; &#x6216;&#x8005; &#x6EE1;&#x8DB3;&#x65B0;&#x751F;&#x6210;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x53BB;&#x6389; .tmp &#x540E;&#x7F00;</li>
<li>&#x6240;&#x76D1;&#x89C6;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x91CD;&#x590D;&#x51FA;&#x73B0;&#x76F8;&#x540C;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x6587;&#x4EF6;&#xFF08;<strong>&#x51FA;&#x9519;&#x540E;&#x4E0D;&#x4F1A;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;</strong>&#xFF09;</li>
</ul>
</li>
<li><p>Sink&#xFF1A;hdfs</p>
<ul>
<li><p>round&#x3001;roundValue&#x3001;roundUnit</p>
<p>&#x63A7;&#x5236;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x63A7;&#x5236;hdfs&#x4E0A;&#x5C0F;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
</li>
<li><p>rollInterval&#x3001;rollSize&#x3001;rollCount</p>
<p>&#x63A7;&#x5236;&#x6EDA;&#x52A8;&#x751F;&#x6210;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x3001;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x3001;&#x4E8B;&#x4EF6;&#x6570;&#x91CF;&#xFF0C;&#x5F53;&#x5168;&#x90E8;&#x8BBE;&#x7F6E;&#x4E3A;0&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;&#x57FA;&#x4E8E;&#x6B64;&#x4E09;&#x9879;&#x751F;&#x6210;&#x6587;&#x4EF6;&#x3002;</p>
</li>
</ul>
</li>
</ul>
<h3 id="&#x542F;&#x52A8;_1"><a name="&#x542F;&#x52A8;_1" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.2. &#x542F;&#x52A8;</h3>
<pre><code class="lang-bash">flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> spooldir.conf -n a1 -Dflume.root.logger=INFO,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_1"><a name="&#x6D4B;&#x8BD5;_1" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.3. &#x6D4B;&#x8BD5;</h3>
<p>spooldir.sh</p>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash
</span>
i=0

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> $((++i)) &gt;&gt; /home/hadoop/flumedatas/spooldir/<span class="hljs-variable">$i</span>;
    sleep 10;
<span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="lang-bash">sh spooldir.sh
</code></pre>
<h2 id="&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;hdfs"><a name="&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;hdfs" class="anchor-navigation-ex-anchor" href="#&#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;hdfs"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x91C7;&#x96C6;&#x6587;&#x4EF6;&#x5230;HDFS</h2>
<h3 id="&#x914D;&#x7F6E;_2"><a name="&#x914D;&#x7F6E;_2" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_2"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. &#x914D;&#x7F6E;</h3>
<p>taillog.conf</p>
<pre><code class="lang-properties">agent1.sources = source1
agent1.sinks = sink1
agent1.channels = channel1

# Describe/configure tail -F source1
agent1.sources.source1.type = exec
agent1.sources.source1.command = tail -F /home/hadoop/flumedatas/taillog/access_log

# Describe sink1
agent1.sinks.sink1.type = hdfs
agent1.sinks.sink1.hdfs.path = hdfs://node01:8020/test/flume/taillog/%y-%m-%d/%H-%M
agent1.sinks.sink1.hdfs.filePrefix = access_log
agent1.sinks.sink1.hdfs.maxOpenFiles = 5000
agent1.sinks.sink1.hdfs.batchSize = 100
agent1.sinks.sink1.hdfs.fileType = DataStream
agent1.sinks.sink1.hdfs.writeFormat = Text

# &#x6EDA;&#x52A8;&#x751F;&#x6210;&#x65B0;&#x6587;&#x4EF6;&#xFF0C;hdfs.rollInterval&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x9ED8;&#x8BA4;30s
agent1.sinks.sink1.hdfs.rollSize = 102400
agent1.sinks.sink1.hdfs.rollCount = 1000000

# &#x6BCF;10&#x5206;&#x949F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;hdfs.round&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x65F6;&#x95F4;&#x6233;&#x56DB;&#x820D;&#x4E94;&#x5165;&#x624D;&#x4F1A;&#x751F;&#x6548;&#xFF1B;&#x5426;&#x5219;1&#x5206;&#x949F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;
agent1.sinks.sink1.hdfs.round = true
agent1.sinks.sink1.hdfs.roundValue = 10
agent1.sinks.sink1.hdfs.roundUnit = minute

agent1.sinks.sink1.hdfs.useLocalTimeStamp = true

# Use a channel which buffers events in memory
agent1.channels.channel1.type = memory
agent1.channels.channel1.keep-alive = 120
agent1.channels.channel1.capacity = 500000
agent1.channels.channel1.transactionCapacity = 600

# Bind the source and sink to the channel
agent1.sources.source1.channels = channel1
agent1.sinks.sink1.channel = channel1
</code></pre>
<ul>
<li><p>tail -F</p>
<ul>
<li>&#x9996;&#x6B21;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x53EA;&#x52A0;&#x8F7D;&#x6587;&#x4EF6;&#x6700;&#x540E;10&#x884C;&#xFF08;&#x547D;&#x4EE4;&#x6267;&#x884C; &#x6216; flume&#x6267;&#x884C;&#xFF09;</li>
<li>&#x5E38;&#x9A7B;&#x7CFB;&#x7EDF;&#x7A0B;&#x5E8F;&#xFF0C;&#x76D1;&#x63A7;&#x6587;&#x4EF6;&#x672B;&#x5C3E;&#x8FFD;&#x52A0;</li>
</ul>
</li>
<li><p>Sink&#xFF1A;hdfs</p>
<ul>
<li>&#x6700;&#x4E0B;&#x5C42;&#x6587;&#x4EF6;&#x5939;&#x662F; <code>&#x5C0F;&#x65F6;-&#x5206;&#x949F;</code> &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6BCF;&#x5206;&#x949F;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF08;hdfs.round=false&#xFF09;&#x3002;&#x89C2;&#x5BDF;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x53D1;&#x73B0;&#xFF0C;&#x6BCF;&#x5206;&#x949F;&#x4F1A;&#x6709;&#x4E24;&#x4E2A;&#x5C0F;&#x6587;&#x4EF6;&#xFF0C;&#x662F;&#x56E0;&#x4E3A; <code>hdfs.rollInterval</code> &#x9ED8;&#x8BA4;30&#x79D2;&#x6EDA;&#x52A8;&#x751F;&#x6210;&#x65B0;&#x6587;&#x4EF6;&#x3002;</li>
</ul>
</li>
</ul>
<h3 id="&#x542F;&#x52A8;_2"><a name="&#x542F;&#x52A8;_2" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_2"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2. &#x542F;&#x52A8;</h3>
<pre><code class="lang-bash">flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> taillog.conf -n agent1 -Dflume.root.logger=INFO,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_2"><a name="&#x6D4B;&#x8BD5;_2" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_2"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3. &#x6D4B;&#x8BD5;</h3>
<p>taillog.sh</p>
<pre><code class="lang-shell">#!/bin/bash

while true
do
    date &gt;&gt; /home/hadoop/flumedatas/taillog/access_log;
    sleep 0.5;
done
</code></pre>
<pre><code class="lang-bash">sh taillog.sh
</code></pre>
<h2 id="&#x65AD;&#x70B9;&#x7EED;&#x4F20;"><a name="&#x65AD;&#x70B9;&#x7EED;&#x4F20;" class="anchor-navigation-ex-anchor" href="#&#x65AD;&#x70B9;&#x7EED;&#x4F20;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. &#x65AD;&#x70B9;&#x7EED;&#x4F20;</h2>
<h3 id="&#x914D;&#x7F6E;_3"><a name="&#x914D;&#x7F6E;_3" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_3"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. &#x914D;&#x7F6E;</h3>
<p>taildir.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = TAILDIR
# record the inode, the absolute path and the last position of each tailing file
a1.sources.r1.positionFile = /home/hadoop/flumedatas/taildir_position.json
# &#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7EC4;&#xFF08;&#x76D1;&#x63A7;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#xFF09;&#xFF0C;&#x4EE5;&#x7A7A;&#x683C;&#x5206;&#x9694;&#xFF0C;&#x5982;&#xFF1A;a1.sources.r1.filegroups = f1 f2
a1.sources.r1.filegroups = f1
a1.sources.r1.filegroups.f1 = /home/hadoop/flumedatas/taildir/.*log.*

# Describe the sink
a1.sinks.k1.type = hdfs
a1.sinks.k1.hdfs.path = hdfs://node01:8020/test/flume/taildir/files/%y-%m-%d/%H%M/
a1.sinks.k1.hdfs.filePrefix = events-

a1.sinks.k1.hdfs.round = true
a1.sinks.k1.hdfs.roundValue = 10
a1.sinks.k1.hdfs.roundUnit = minute

a1.sinks.k1.hdfs.rollInterval = 3
a1.sinks.k1.hdfs.rollSize = 5000
a1.sinks.k1.hdfs.rollCount = 50000

a1.sinks.k1.hdfs.batchSize = 5000
a1.sinks.k1.hdfs.useLocalTimeStamp = true
a1.sinks.k1.hdfs.fileType = DataStream

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<ul>
<li>Sink&#xFF1A;TAILDIR<ul>
<li>&#x53EF;&#x4EE5;&#x76D1;&#x63A7;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76D1;&#x63A7;&#x6587;&#x4EF6;&#x5185;&#x5BB9;</li>
<li>&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#x529F;&#x80FD;&#xFF0C;&#x539F;&#x7406;&#x662F; taildir_position.json &#xFF08;&#x81EA;&#x52A8;&#x751F;&#x6210;&#xFF09;&#x8BB0;&#x5F55;&#x6BCF;&#x4E00;&#x6B21;&#x751F;&#x6210;&#x4E8B;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;</li>
</ul>
</li>
</ul>
<h3 id="&#x542F;&#x52A8;_3"><a name="&#x542F;&#x52A8;_3" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_3"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.2. &#x542F;&#x52A8;</h3>
<pre><code class="lang-bash">flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> taildir.conf -n a1 -Dflume.root.logger=INFO,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_3"><a name="&#x6D4B;&#x8BD5;_3" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_3"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.3. &#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-bash"><span class="hljs-comment"># &gt; &#x65B0;&#x589E;&#x6587;&#x4EF6;&#x5199;&#x5165;&#x5185;&#x5BB9;</span>
<span class="hljs-comment"># &gt;&gt; &#x8FFD;&#x52A0;&#x5185;&#x5BB9;&#x5230;&#x6587;&#x4EF6;&#x672B;&#x5C3E;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;testlog1&quot;</span> &gt;&gt; /home/hadoop/flumedatas/taildir/file.log
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;testlog2&quot;</span> &gt;&gt; /home/hadoop/flumedatas/taildir/file.log
</code></pre>
<h2 id="&#x7EA7;&#x8054;agent"><a name="&#x7EA7;&#x8054;agent" class="anchor-navigation-ex-anchor" href="#&#x7EA7;&#x8054;agent"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x7EA7;&#x8054;Agent</h2>
<h3 id="&#x5B89;&#x88C5;"><a name="&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1. &#x5B89;&#x88C5;</h3>
<p>node03&#x6267;&#x884C;</p>
<pre><code class="lang-bash">scp -r apache-flume-1.6.0-cdh5.14.2-bin/ node02:<span class="hljs-variable">$PWD</span>
</code></pre>
<p>node02&#x6267;&#x884C;</p>
<p>&#x914D;&#x7F6E;/etc/profile</p>
<pre><code class="lang-bash">sudo vi /etc/profile

<span class="hljs-comment"># &#x589E;&#x52A0;flume&#x73AF;&#x5883;&#x53D8;&#x91CF;</span>
<span class="hljs-built_in">export</span> FLUME_HOME=/bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$FLUME_HOME</span>/bin

<span class="hljs-comment"># &#x7ACB;&#x5373;&#x751F;&#x6548;</span>
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
<h3 id="&#x914D;&#x7F6E;_4"><a name="&#x914D;&#x7F6E;_4" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_4"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.2. &#x914D;&#x7F6E;</h3>
<p>node02</p>
<p>tail-avro-avro-logger.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /home/hadoop/flumedatas/taillog/access_log

# Describe the sink
# &#x6570;&#x636E;&#x53D1;&#x9001;
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = node03
a1.sinks.k1.port = 4141
a1.sinks.k1.batch-size = 10

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<p>node03</p>
<p>avro-hdfs.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
# &#x6570;&#x636E;&#x63A5;&#x6536;
a1.sources.r1.type = avro
a1.sources.r1.bind = node03
a1.sources.r1.port = 4141

# Describe the sink
a1.sinks.k1.type = hdfs
a1.sinks.k1.hdfs.path = hdfs://node01:8020/test/flume/avro/hdfs/%y-%m-%d/%H%M/
a1.sinks.k1.hdfs.filePrefix = events-
a1.sinks.k1.hdfs.round = true
a1.sinks.k1.hdfs.roundValue = 10
a1.sinks.k1.hdfs.roundUnit = minute
a1.sinks.k1.hdfs.rollInterval = 3
a1.sinks.k1.hdfs.rollSize = 20
a1.sinks.k1.hdfs.rollCount = 5
a1.sinks.k1.hdfs.batchSize = 1
a1.sinks.k1.hdfs.useLocalTimeStamp = true
a1.sinks.k1.hdfs.fileType = DataStream

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<h3 id="&#x542F;&#x52A8;_4"><a name="&#x542F;&#x52A8;_4" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_4"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.3. &#x542F;&#x52A8;</h3>
<pre><code class="lang-bash"><span class="hljs-comment"># node03</span>
flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> avro-hdfs.conf -n a1 -Dflume.root.logger=INFO,console

<span class="hljs-comment"># node02</span>
flume-ng agent -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf <span class="hljs-_">-f</span> tail-avro-avro-logger.conf -n a1 -Dflume.root.logger=INFO,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_4"><a name="&#x6D4B;&#x8BD5;_4" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_4"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.4. &#x6D4B;&#x8BD5;</h3>
<p>node02</p>
<p>taillog.sh</p>
<pre><code class="lang-shell">while true
do
    date &gt;&gt; /home/hadoop/flumedatas/taillog/access_log;
    sleep 0.5;
done
</code></pre>
<pre><code class="lang-bash">sh taillog.sh
</code></pre>
<h1 id="failover-&#x6545;&#x969C;&#x8F6C;&#x79FB;"><a name="failover-&#x6545;&#x969C;&#x8F6C;&#x79FB;" class="anchor-navigation-ex-anchor" href="#failover-&#x6545;&#x969C;&#x8F6C;&#x79FB;"><i class="fa fa-link" aria-hidden="true"></i></a>3. failover &#x6545;&#x969C;&#x8F6C;&#x79FB;</h1>
<p>Flume NG &#x672C;&#x8EAB;&#x63D0;&#x4F9B;&#x4E86;Failover&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x548C;&#x6062;&#x590D;&#x3002;</p>
<h2 id="&#x89C4;&#x5212;"><a name="&#x89C4;&#x5212;" class="anchor-navigation-ex-anchor" href="#&#x89C4;&#x5212;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x89C4;&#x5212;</h2>
<table>
<thead>
<tr>
<th>&#x4E3B;&#x673A;</th>
<th>&#x89D2;&#x8272;</th>
<th>&#x89D2;&#x8272;</th>
</tr>
</thead>
<tbody>
<tr>
<td>node01</td>
<td>agent1</td>
<td>Web Server</td>
</tr>
<tr>
<td>node02</td>
<td>collector1</td>
<td>AgentMstr1</td>
</tr>
<tr>
<td>node03</td>
<td>collector2</td>
<td>AgentMstr2</td>
</tr>
</tbody>
</table>
<h2 id="&#x5B89;&#x88C5;_1"><a name="&#x5B89;&#x88C5;_1" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. &#x5B89;&#x88C5;</h2>
<p>node03&#x6267;&#x884C;</p>
<pre><code class="lang-bash">scp -r apache-flume-1.6.0-cdh5.14.2-bin/ node01:<span class="hljs-variable">$PWD</span>
</code></pre>
<p>node01&#x6267;&#x884C;</p>
<p>&#x914D;&#x7F6E;/etc/profile</p>
<pre><code class="lang-bash">sudo vi /etc/profile

<span class="hljs-comment"># &#x589E;&#x52A0;flume&#x73AF;&#x5883;&#x53D8;&#x91CF;</span>
<span class="hljs-built_in">export</span> FLUME_HOME=/bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$FLUME_HOME</span>/bin

<span class="hljs-comment"># &#x7ACB;&#x5373;&#x751F;&#x6548;</span>
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
<h2 id="&#x914D;&#x7F6E;_5"><a name="&#x914D;&#x7F6E;_5" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_5"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x914D;&#x7F6E;</h2>
<p>node01</p>
<p>agent.conf</p>
<pre><code class="lang-properties"># agent1 name
agent1.channels = c1
agent1.sources = r1
agent1.sinks = k1 k2

# set channel
agent1.channels.c1.type = memory
agent1.channels.c1.capacity = 1000
agent1.channels.c1.transactionCapacity = 100

# set sources
agent1.sources.r1.channels = c1
agent1.sources.r1.type = exec
agent1.sources.r1.command = tail -F /home/hadoop/flumedatas/taillogs/access_log

# &#x62E6;&#x622A;&#x5668;&#x662F;&#x7B80;&#x5355;&#x7684;&#x63D2;&#x4EF6;&#x5F0F;&#x7EC4;&#x4EF6;&#xFF0C;&#x8BBE;&#x7F6E;&#x5728;source&#x548C;channel&#x4E4B;&#x95F4;
# &#x591A;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x7EC4;&#x6210;&#x4E86; interceptor chain &#x6309;&#x58F0;&#x660E;&#x987A;&#x5E8F;&#x8C03;&#x7528;
# &#x9759;&#x6001;&#x62E6;&#x622A;&#x5668;
# &#x5728;header&#x4E2D;&#x589E;&#x52A0;kv&#x5BF9;
agent1.sources.r1.interceptors = i1 i2
agent1.sources.r1.interceptors.i1.type = static
agent1.sources.r1.interceptors.i1.key = Type
agent1.sources.r1.interceptors.i1.value = LOGIN
# &#x65F6;&#x95F4;&#x6233;&#x62E6;&#x622A;&#x5668;
# &#x5728;header&#x4E2D;&#x589E;&#x52A0;&#x65F6;&#x95F4;&#x6233;
agent1.sources.r1.interceptors.i2.type = timestamp

# set sink1
agent1.sinks.k1.channel = c1
agent1.sinks.k1.type = avro
agent1.sinks.k1.hostname = node02
agent1.sinks.k1.port = 52020

# set sink2
agent1.sinks.k2.channel = c1
agent1.sinks.k2.type = avro
agent1.sinks.k2.hostname = node03
agent1.sinks.k2.port = 52020

# set sink group
agent1.sinkgroups = g1
agent1.sinkgroups.g1.sinks = k1 k2
agent1.sinkgroups.g1.processor.type = failover
# &#x5148;&#x5411;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#x7684;&#x53D1;&#x9001;event
# &#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x4F18;&#x5148;&#x7EA7;&#x76F8;&#x540C;&#xFF0C;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x4F1A;&#x5931;&#x8D25;
agent1.sinkgroups.g1.processor.priority.k1 = 10
agent1.sinkgroups.g1.processor.priority.k2 = 1
agent1.sinkgroups.g1.processor.maxpenalty = 10000
</code></pre>
<p>node02</p>
<p>collector.conf</p>
<pre><code class="lang-properties"># set Agent name
a1.sources = r1
a1.channels = c1
a1.sinks = k1

# set channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# set sources
a1.sources.r1.type = avro
a1.sources.r1.bind = node02
a1.sources.r1.port = 52020
a1.sources.r1.interceptors = i1
a1.sources.r1.interceptors.i1.type = static
a1.sources.r1.interceptors.i1.key = Collector
a1.sources.r1.interceptors.i1.value = node02
a1.sources.r1.channels = c1

# set sink
a1.sinks.k1.type=hdfs
a1.sinks.k1.hdfs.filePrefix=%Y-%m-%d
a1.sinks.k1.hdfs.path= hdfs://node01:8020/test/flume/failover/node02
a1.sinks.k1.hdfs.fileType=DataStream
a1.sinks.k1.hdfs.writeFormat=TEXT
a1.sinks.k1.hdfs.rollInterval=10
a1.sinks.k1.channel=c1
</code></pre>
<p>node03</p>
<p>collector.conf</p>
<pre><code class="lang-properties"># set Agent name
a1.sources = r1
a1.channels = c1
a1.sinks = k1

# set channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# set sources
a1.sources.r1.type = avro
a1.sources.r1.bind = node03
a1.sources.r1.port = 52020
a1.sources.r1.interceptors = i1
a1.sources.r1.interceptors.i1.type = static
a1.sources.r1.interceptors.i1.key = Collector
a1.sources.r1.interceptors.i1.value = node03
a1.sources.r1.channels = c1

# set sink
a1.sinks.k1.type=hdfs
a1.sinks.k1.hdfs.filePrefix=%Y-%m-%d
a1.sinks.k1.hdfs.path= hdfs://node01:8020/test/flume/failover/node03
a1.sinks.k1.hdfs.fileType=DataStream
a1.sinks.k1.hdfs.writeFormat=TEXT
a1.sinks.k1.hdfs.rollInterval=10
a1.sinks.k1.channel=c1
</code></pre>
<h2 id="&#x542F;&#x52A8;_5"><a name="&#x542F;&#x52A8;_5" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_5"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. &#x542F;&#x52A8;</h2>
<pre><code class="lang-shell"># node03 &#x542F;&#x52A8;
flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f collector.conf -Dflume.root.logger=DEBUG,console

# node02 &#x542F;&#x52A8;
flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f collector.conf -Dflume.root.logger=DEBUG,console

# node01 &#x542F;&#x52A8;
flume-ng agent -n agent1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f agent.conf -Dflume.root.logger=DEBUG,console
</code></pre>
<h2 id="&#x6D4B;&#x8BD5;_5"><a name="&#x6D4B;&#x8BD5;_5" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_5"><i class="fa fa-link" aria-hidden="true"></i></a>3.5. &#x6D4B;&#x8BD5;</h2>
<pre><code class="lang-shell"># &#x53D1;&#x9001;&#x6570;&#x636E;
echo &quot;1&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log

# node02 &#x6536;&#x5230;&#x6570;&#x636E;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#xFF09;

# &#x5173;&#x95ED; node02

# &#x53D1;&#x9001;&#x6570;&#x636E;
echo &quot;2&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log

# node03 &#x6536;&#x5230;&#x6570;&#x636E;&#xFF08;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#xFF09;

# &#x6062;&#x590D; node02

# &#x53D1;&#x9001;&#x6570;&#x636E;
echo &quot;3&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log

# node02 &#x6536;&#x5230;&#x6570;&#x636E;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#xFF09;
</code></pre>
<h1 id="load-balance-&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><a name="load-balance-&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="anchor-navigation-ex-anchor" href="#load-balance-&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><i class="fa fa-link" aria-hidden="true"></i></a>4. load balance &#x8D1F;&#x8F7D;&#x5747;&#x8861;</h1>
<p>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x662F;&#x7528;&#x4E8E;&#x89E3;&#x51B3;&#x4E00;&#x53F0;&#x673A;&#x5668;&#xFF08;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF09;&#x65E0;&#x6CD5;&#x89E3;&#x51B3;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x800C;&#x4EA7;&#x751F;&#x7684;&#x4E00;&#x79CD;&#x7B97;&#x6CD5;&#x3002;Load balancing Sink Processor &#x80FD;&#x591F;&#x5B9E;&#x73B0; load balance &#x529F;&#x80FD;&#x3002;</p>
<h2 id="&#x89C4;&#x5212;_1"><a name="&#x89C4;&#x5212;_1" class="anchor-navigation-ex-anchor" href="#&#x89C4;&#x5212;_1"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. &#x89C4;&#x5212;</h2>
<table>
<thead>
<tr>
<th>&#x4E3B;&#x673A;</th>
<th>&#x540D;&#x79F0;</th>
<th>&#x89D2;&#x8272;</th>
</tr>
</thead>
<tbody>
<tr>
<td>node01</td>
<td>client</td>
<td>&#x91C7;&#x96C6;&#x6570;&#x636E;&#xFF0C;&#x53D1;&#x9001;&#x5230;node02&#x548C;node03</td>
</tr>
<tr>
<td>node02</td>
<td>server</td>
<td>&#x63A5;&#x6536;node01&#x90E8;&#x5206;&#x6570;&#x636E;</td>
</tr>
<tr>
<td>node03</td>
<td>server</td>
<td>&#x63A5;&#x6536;node01&#x90E8;&#x5206;&#x6570;&#x636E;</td>
</tr>
</tbody>
</table>
<h2 id="&#x914D;&#x7F6E;_6"><a name="&#x914D;&#x7F6E;_6" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_6"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. &#x914D;&#x7F6E;</h2>
<p>node01</p>
<p>load_banlancer_client.conf</p>
<pre><code class="lang-properties"># agent name
a1.channels = c1
a1.sources = r1
a1.sinks = k1 k2

# set channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# set source
a1.sources.r1.channels = c1
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /home/hadoop/flumedatas/taillogs/access_log

# set sink1
a1.sinks.k1.channel = c1
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = node02
a1.sinks.k1.port = 52020

# set sink2
a1.sinks.k2.channel = c1
a1.sinks.k2.type = avro
a1.sinks.k2.hostname = node03
a1.sinks.k2.port = 52020

# set sink group
a1.sinkgroups = g1
a1.sinkgroups.g1.sinks = k1 k2
a1.sinkgroups.g1.processor.type = load_balance
a1.sinkgroups.g1.processor.backoff = true
# &#x8F6E;&#x8BE2;
a1.sinkgroups.g1.processor.selector = round_robin
a1.sinkgroups.g1.processor.selector.maxTimeOut=10000
</code></pre>
<p>node02</p>
<p>load_banlancer_server.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = avro
a1.sources.r1.channels = c1
a1.sources.r1.bind = node02
a1.sources.r1.port = 52020

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<p>node03</p>
<p>load_banlancer_server.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = avro
a1.sources.r1.channels = c1
a1.sources.r1.bind = node03
a1.sources.r1.port = 52020

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<h2 id="&#x542F;&#x52A8;_6"><a name="&#x542F;&#x52A8;_6" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_6"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. &#x542F;&#x52A8;</h2>
<pre><code class="lang-shell"># node03 &#x542F;&#x52A8;
flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f load_banlancer_server.conf -Dflume.root.logger=DEBUG,console

# node02 &#x542F;&#x52A8;
flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f load_banlancer_server.conf -Dflume.root.logger=DEBUG,console

# node01 &#x542F;&#x52A8;
flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f load_banlancer_client.conf -Dflume.root.logger=DEBUG,console
</code></pre>
<h2 id="&#x6D4B;&#x8BD5;_6"><a name="&#x6D4B;&#x8BD5;_6" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_6"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. &#x6D4B;&#x8BD5;</h2>
<pre><code class="lang-shell"># &#x8F6E;&#x8BE2;
# node02
echo &quot;1&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;2&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node02
echo &quot;3&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;4&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log

# close node02

# node03 &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x63A5;&#x6536;
# node03
echo &quot;5&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
echo &quot;6&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
echo &quot;7&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log

# start node02

# node02 node03 &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x63A5;&#x6536;
# node02
echo &quot;8&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;9&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;10&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;11&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node02
echo &quot;12&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;13&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node02
echo &quot;14&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node02
echo &quot;15&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;16&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node02
echo &quot;17&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
# node03
echo &quot;18&quot; &gt;&gt; /home/hadoop/flumedatas/taillogs/access_log
</code></pre>
<h1 id="&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;"><a name="&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7EC4;&#x4EF6;</h1>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;interceptor"><a name="&#x81EA;&#x5B9A;&#x4E49;interceptor" class="anchor-navigation-ex-anchor" href="#&#x81EA;&#x5B9A;&#x4E49;interceptor"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. &#x81EA;&#x5B9A;&#x4E49;Interceptor</h2>
<h3 id="&#x9700;&#x6C42;"><a name="&#x9700;&#x6C42;" class="anchor-navigation-ex-anchor" href="#&#x9700;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.1. &#x9700;&#x6C42;</h3>
<p>&#x5C06;&#x6570;&#x636E;&#x7B2C;&#x4E00;&#x4F4D;&#x7535;&#x8BDD;&#x53F7;&#x7801;&#x52A0;&#x5BC6;&#xFF0C;&#x7B2C;4&#x4F4D;&#x5174;&#x8DA3;&#x8FC7;&#x6EE4;</p>
<h3 id="&#x51C6;&#x5907;&#x6570;&#x636E;"><a name="&#x51C6;&#x5907;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x51C6;&#x5907;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.2. &#x51C6;&#x5907;&#x6570;&#x636E;</h3>
<pre><code class="lang-shell">vi user.txt

13901007610,male,30,sing,beijing
18600000035,male,40,dance,shanghai
13366666659,male,20,Swimming,wuhan
13801179888,female,18,dance,tianjin
18511111114,male,35,sing,beijing
13718428888,female,40,Foodie,shanghai
13901057088,male,50,Basketball,taiwan
13671057777,male,60,Bodybuilding,xianggang
</code></pre>
<h3 id="&#x5F00;&#x53D1;"><a name="&#x5F00;&#x53D1;" class="anchor-navigation-ex-anchor" href="#&#x5F00;&#x53D1;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.3. &#x5F00;&#x53D1;</h3>
<p>&#x6DFB;&#x52A0;xml&#x4F9D;&#x8D56;</p>
<pre><code class="lang-xml"><span class="hljs-comment">&lt;!-- flume --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.flume<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flume-ng-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>UserInterceptor.java</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Interceptor</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> encrypted_field_index;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> out_index;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserInterceptor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> encrypted_field_index, <span class="hljs-keyword">int</span> out_index)</span> </span>{
        <span class="hljs-keyword">this</span>.encrypted_field_index = encrypted_field_index;
        <span class="hljs-keyword">this</span>.out_index = out_index;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Event <span class="hljs-title">intercept</span><span class="hljs-params">(Event event)</span> </span>{
        String line = <span class="hljs-keyword">new</span> String(event.getBody(), Charsets.UTF_8);
        String newLine = <span class="hljs-string">&quot;&quot;</span>;
        String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fields.length; i++) {
            <span class="hljs-keyword">if</span> (i == encrypted_field_index) {
                <span class="hljs-keyword">try</span> {
                    newLine += md5(fields[i]) + <span class="hljs-string">&quot;,&quot;</span>;
                } <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i == out_index) {
                <span class="hljs-comment">// do nothing</span>
            } <span class="hljs-keyword">else</span> {
                newLine += fields[i] + <span class="hljs-string">&quot;,&quot;</span>;
            }
        }

        newLine = newLine.substring(<span class="hljs-number">0</span>, newLine.length() - <span class="hljs-number">1</span>);
        event.setBody(newLine.getBytes(Charsets.UTF_8));

        <span class="hljs-keyword">return</span> event;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Event&gt; <span class="hljs-title">intercept</span><span class="hljs-params">(List&lt;Event&gt; list)</span> </span>{
        List&lt;Event&gt; newList = <span class="hljs-keyword">new</span> ArrayList();
        <span class="hljs-keyword">for</span> (Event e : list) {
            Event test = intercept(e);
            <span class="hljs-keyword">if</span> (test != <span class="hljs-keyword">null</span>) {
                newList.add(test);
            }
        }
        <span class="hljs-keyword">return</span> newList;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>{

    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">md5</span><span class="hljs-params">(String plainText)</span> <span class="hljs-keyword">throws</span> NoSuchAlgorithmException </span>{
        <span class="hljs-keyword">byte</span>[] secretBytes = <span class="hljs-keyword">null</span>;

        MessageDigest md5 = MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);
        md5.update(plainText.getBytes());
        secretBytes = md5.digest();

        String result = <span class="hljs-keyword">new</span> BigInteger(<span class="hljs-number">1</span>, secretBytes).toString(<span class="hljs-number">16</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span> - result.length(); i++) {
            result = <span class="hljs-string">&quot;0&quot;</span> + result;
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Builder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Interceptor</span>.<span class="hljs-title">Builder</span> </span>{
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> encrypted_field_index;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> out_index;

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Interceptor <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserInterceptor(encrypted_field_index, out_index);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(Context context)</span> </span>{
            encrypted_field_index = context.getInteger(<span class="hljs-string">&quot;encrypted_field_index&quot;</span>);
            out_index = context.getInteger(<span class="hljs-string">&quot;out_index&quot;</span>);
        }
    }
}
</code></pre>
<h3 id="&#x4E0A;&#x4F20;jar"><a name="&#x4E0A;&#x4F20;jar" class="anchor-navigation-ex-anchor" href="#&#x4E0A;&#x4F20;jar"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.4. &#x4E0A;&#x4F20;jar</h3>
<pre><code class="lang-shell"># &#x81EA;&#x5B9A;&#x4E49; interceptor &#x4E0A;&#x4F20;&#x5230; plugins.d/mysqlsource/lib
scp hadoop-flume-example-1.0-SNAPSHOT.jar hadoop@node03:/bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/plugins.d/mysqlsource/lib
</code></pre>
<h3 id="&#x914D;&#x7F6E;_7"><a name="&#x914D;&#x7F6E;_7" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_7"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.5. &#x914D;&#x7F6E;</h3>
<p>user.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# &#x914D;&#x7F6E;source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /home/hadoop/flumedatas/user/user.txt
a1.sources.r1.channels = c1
a1.sources.r1.interceptors =i1
# &#x81EA;&#x5B9A;&#x4E49;interceptor&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5305;&#x540D;
a1.sources.r1.interceptors.i1.type = com.sciatta.hadoop.flume.example.interceptor.UserInterceptor$Builder
a1.sources.r1.interceptors.i1.encrypted_field_index=0
a1.sources.r1.interceptors.i1.out_index=3

# &#x914D;&#x7F6E;channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# &#x914D;&#x7F6E;sink
a1.sinks.k1.type = hdfs
a1.sinks.k1.channel = c1
a1.sinks.k1.hdfs.path = hdfs://node01:8020/test/flume/user/%Y-%m-%d/%H%M
a1.sinks.k1.hdfs.filePrefix = events-

a1.sinks.k1.hdfs.round = true
a1.sinks.k1.hdfs.roundValue = 10
a1.sinks.k1.hdfs.roundUnit = minute

a1.sinks.k1.hdfs.rollInterval = 5
a1.sinks.k1.hdfs.rollSize = 50
a1.sinks.k1.hdfs.rollCount = 10

a1.sinks.k1.hdfs.batchSize = 100
a1.sinks.k1.hdfs.useLocalTimeStamp = true
a1.sinks.k1.hdfs.fileType = DataStream
</code></pre>
<h3 id="&#x542F;&#x52A8;_7"><a name="&#x542F;&#x52A8;_7" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_7"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.6. &#x542F;&#x52A8;</h3>
<pre><code class="lang-shell">flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f user.conf -Dflume.root.logger=DEBUG,console
</code></pre>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;source"><a name="&#x81EA;&#x5B9A;&#x4E49;source" class="anchor-navigation-ex-anchor" href="#&#x81EA;&#x5B9A;&#x4E49;source"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. &#x81EA;&#x5B9A;&#x4E49;Source</h2>
<h3 id="&#x9700;&#x6C42;_1"><a name="&#x9700;&#x6C42;_1" class="anchor-navigation-ex-anchor" href="#&#x9700;&#x6C42;_1"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.1. &#x9700;&#x6C42;</h3>
<p>&#x81EA;&#x5B9A;&#x4E49;flume&#x7684;source&#xFF0C;&#x5B9E;&#x73B0;&#x4ECE;mysql&#x6570;&#x636E;&#x5E93;&#x5F53;&#x4E2D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x6253;&#x5370;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x3002;</p>
<h3 id="&#x51C6;&#x5907;&#x6570;&#x636E;_1"><a name="&#x51C6;&#x5907;&#x6570;&#x636E;_1" class="anchor-navigation-ex-anchor" href="#&#x51C6;&#x5907;&#x6570;&#x636E;_1"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.2. &#x51C6;&#x5907;&#x6570;&#x636E;</h3>
<pre><code class="lang-mysql">create database if not exists mysqlsource default character set utf8;

-- &#x62C9;&#x53D6;&#x76EE;&#x6807;&#x8868;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;
drop table if exists mysqlsource.flume_meta;
CREATE TABLE mysqlsource.flume_meta (
  source_tab varchar(255) NOT NULL,
  currentIndex varchar(255) NOT NULL,
  PRIMARY KEY (source_tab)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- &#x63D2;&#x5165;&#x6570;&#x636E;
insert into mysqlsource.flume_meta(source_tab,currentIndex) values (&apos;student&apos;,&apos;4&apos;);

-- &#x62C9;&#x53D6;&#x76EE;&#x6807;&#x8868;
-- AUTO_INCREMENT &#x6307;&#x5B9A;&#x81EA;&#x589E;&#x521D;&#x59CB;&#x503C;
drop table if exists mysqlsource.student;
CREATE TABLE mysqlsource.student(
  id int(11) NOT NULL AUTO_INCREMENT,
  name varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- &#x5411;student&#x8868;&#x4E2D;&#x6DFB;&#x52A0;&#x6D4B;&#x8BD5;&#x6570;&#x636E;
insert into mysqlsource.student(id,name) values (1,&apos;zhangsan&apos;),(2,&apos;lisi&apos;),(3,&apos;wangwu&apos;),(4,&apos;zhaoliu&apos;);
</code></pre>
<h3 id="&#x5F00;&#x53D1;_1"><a name="&#x5F00;&#x53D1;_1" class="anchor-navigation-ex-anchor" href="#&#x5F00;&#x53D1;_1"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.3. &#x5F00;&#x53D1;</h3>
<p>&#x6DFB;&#x52A0;xml&#x4F9D;&#x8D56;</p>
<pre><code class="lang-xml"><span class="hljs-comment">&lt;!-- flume --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.flume<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flume-ng-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- mysql --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>MySQLHelper.java</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySQLHelper</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LoggerFactory.getLogger(MySQLHelper.class);

    <span class="hljs-comment">// &#x4E24;&#x6B21;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694;</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> runQueryDelay;
    <span class="hljs-comment">// &#x5F00;&#x59CB;id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> startFrom;
    <span class="hljs-comment">// &#x5F53;&#x524D;id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> currentIndex;

    <span class="hljs-comment">// &#x8981;&#x64CD;&#x4F5C;&#x7684;&#x8868;</span>
    <span class="hljs-keyword">private</span> String table;
    <span class="hljs-comment">// &#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;&#x67E5;&#x8BE2;&#x7684;&#x5217;</span>
    <span class="hljs-keyword">private</span> String columnsToSelect;

    <span class="hljs-comment">// &#x4E3A;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#xFF09;&#xFF0C;&#x53EF;&#x5728;flume&#x4EFB;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x4FEE;&#x6539;</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_QUERY_DELAY = <span class="hljs-number">10000</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_START_VALUE = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_COLUMNS_SELECT = <span class="hljs-string">&quot;*&quot;</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Connection conn = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> PreparedStatement ps = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String connectionURL, connectionUserName, connectionPassword;

    <span class="hljs-keyword">static</span> {
        Properties p = <span class="hljs-keyword">new</span> Properties();
        <span class="hljs-keyword">try</span> {
            p.load(MySQLHelper.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;jdbc.properties&quot;</span>));
            connectionURL = p.getProperty(<span class="hljs-string">&quot;dbUrl&quot;</span>);
            connectionUserName = p.getProperty(<span class="hljs-string">&quot;dbUser&quot;</span>);
            connectionPassword = p.getProperty(<span class="hljs-string">&quot;dbPassword&quot;</span>);
            <span class="hljs-comment">// &#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;</span>
            Class.forName(p.getProperty(<span class="hljs-string">&quot;dbDriver&quot;</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            LOG.error(e.toString());
        }
    }

    MySQLHelper(Context context) {
        <span class="hljs-comment">// &#x6709;&#x9ED8;&#x8BA4;&#x503C;&#x53C2;&#x6570;&#xFF1A;&#x83B7;&#x53D6;flume&#x4EFB;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8BFB;&#x4E0D;&#x5230;&#x7684;&#x91C7;&#x7528;&#x9ED8;&#x8BA4;&#x503C;</span>
        <span class="hljs-keyword">this</span>.columnsToSelect = context.getString(<span class="hljs-string">&quot;columns.to.select&quot;</span>, DEFAULT_COLUMNS_SELECT);
        <span class="hljs-keyword">this</span>.runQueryDelay = context.getInteger(<span class="hljs-string">&quot;run.query.delay&quot;</span>, DEFAULT_QUERY_DELAY);
        <span class="hljs-keyword">this</span>.startFrom = context.getInteger(<span class="hljs-string">&quot;start.from&quot;</span>, DEFAULT_START_VALUE);

        <span class="hljs-comment">// &#x65E0;&#x9ED8;&#x8BA4;&#x503C;&#x53C2;&#x6570;&#xFF1A;&#x83B7;&#x53D6;flume&#x4EFB;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x53C2;&#x6570;</span>
        <span class="hljs-keyword">this</span>.table = context.getString(<span class="hljs-string">&quot;table&quot;</span>);

        <span class="hljs-comment">// &#x6821;&#x9A8C;&#x76F8;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x9ED8;&#x8BA4;&#x503C;&#x7684;&#x53C2;&#x6570;&#x4E5F;&#x6CA1;&#x8D4B;&#x503C;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span>
        checkMandatoryProperties();

        <span class="hljs-comment">// &#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;</span>
        conn = InitConnection(connectionURL, connectionUserName, connectionPassword);
    }

    MySQLHelper(Properties properties) {
        <span class="hljs-keyword">this</span>.columnsToSelect = properties.getProperty(<span class="hljs-string">&quot;columns.to.select&quot;</span>, DEFAULT_COLUMNS_SELECT);
        <span class="hljs-keyword">this</span>.runQueryDelay = getIntegerFromProperties(properties, <span class="hljs-string">&quot;run.query.delay&quot;</span>, DEFAULT_QUERY_DELAY);
        <span class="hljs-keyword">this</span>.startFrom = getIntegerFromProperties(properties, <span class="hljs-string">&quot;start.from&quot;</span>, DEFAULT_START_VALUE);

        <span class="hljs-comment">// &#x65E0;&#x9ED8;&#x8BA4;&#x503C;&#x53C2;&#x6570;&#xFF1A;&#x83B7;&#x53D6;flume&#x4EFB;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x53C2;&#x6570;</span>
        <span class="hljs-keyword">this</span>.table = properties.getProperty(<span class="hljs-string">&quot;table&quot;</span>);

        <span class="hljs-comment">// &#x6821;&#x9A8C;&#x76F8;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x9ED8;&#x8BA4;&#x503C;&#x7684;&#x53C2;&#x6570;&#x4E5F;&#x6CA1;&#x8D4B;&#x503C;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span>
        checkMandatoryProperties();

        <span class="hljs-comment">// &#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;</span>
        conn = InitConnection(connectionURL, connectionUserName, connectionPassword);
    }

    List&lt;List&lt;Object&gt;&gt; executeQuery() {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// &#x6BCF;&#x6B21;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x751F;&#x6210;sql&#xFF0C;&#x56E0;&#x4E3A;id&#x4E0D;&#x540C;</span>
            String query = buildQuery();
            <span class="hljs-comment">//  &#x5B58;&#x653E;&#x7ED3;&#x679C;&#x7684;&#x96C6;&#x5408;</span>
            List&lt;List&lt;Object&gt;&gt; results = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            <span class="hljs-keyword">if</span> (ps == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;PrepareStatement&#x5BF9;&#x8C61;</span>
                ps = conn.prepareStatement(query);
            }
            ResultSet result = ps.executeQuery(query);
            <span class="hljs-keyword">while</span> (result.next()) {
                <span class="hljs-comment">// &#x5B58;&#x653E;&#x4E00;&#x6761;&#x6570;&#x636E;&#x7684;&#x96C6;&#x5408;&#xFF08;&#x591A;&#x4E2A;&#x5217;&#xFF09;</span>
                List&lt;Object&gt; row = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
                <span class="hljs-comment">// &#x5C06;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x653E;&#x5165;&#x96C6;&#x5408;</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= result.getMetaData().getColumnCount(); i++) {
                    row.add(result.getObject(i));
                }
                results.add(row);
            }
            LOG.info(<span class="hljs-string">&quot;execSql:&quot;</span> + query + <span class="hljs-string">&quot;  resultSize:&quot;</span> + results.size());
            <span class="hljs-keyword">return</span> results;
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            LOG.error(e.toString());
            <span class="hljs-comment">// &#x91CD;&#x65B0;&#x8FDE;&#x63A5;</span>
            conn = InitConnection(connectionURL, connectionUserName, connectionPassword);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateOffset2DB</span><span class="hljs-params">(<span class="hljs-keyword">int</span> size)</span> </span>{
        <span class="hljs-comment">//&#x4EE5;source_tab&#x505A;&#x4E3A;KEY&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x63D2;&#x5165;&#xFF0C;&#x5B58;&#x5728;&#x5219;&#x66F4;&#x65B0;&#xFF08;&#x6BCF;&#x4E2A;&#x6E90;&#x8868;&#x5BF9;&#x5E94;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#xFF09;</span>
        String sql = <span class="hljs-string">&quot;insert into flume_meta(source_tab,currentIndex) VALUES(&apos;&quot;</span>
                + <span class="hljs-keyword">this</span>.table
                + <span class="hljs-string">&quot;&apos;,&apos;&quot;</span> + (currentIndex += size)
                + <span class="hljs-string">&quot;&apos;) on DUPLICATE key update currentIndex=values(currentIndex)&quot;</span>;

        LOG.info(<span class="hljs-string">&quot;updateStatus Sql:&quot;</span> + sql);
        execSql(sql);
    }

    <span class="hljs-function">List&lt;String&gt; <span class="hljs-title">getAllRows</span><span class="hljs-params">(List&lt;List&lt;Object&gt;&gt; queryResult)</span> </span>{
        List&lt;String&gt; allRows = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">if</span> (queryResult == <span class="hljs-keyword">null</span> || queryResult.isEmpty())
            <span class="hljs-keyword">return</span> allRows;
        StringBuilder row = <span class="hljs-keyword">new</span> StringBuilder();
        <span class="hljs-keyword">for</span> (List&lt;Object&gt; rawRow : queryResult) {
            Object value;
            <span class="hljs-keyword">for</span> (Object aRawRow : rawRow) {
                value = aRawRow;
                <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>) {
                    row.append(<span class="hljs-string">&quot;,&quot;</span>);
                } <span class="hljs-keyword">else</span> {
                    row.append(aRawRow.toString()).append(<span class="hljs-string">&quot;,&quot;</span>);
                }
            }
            allRows.add(row.toString());
            row = <span class="hljs-keyword">new</span> StringBuilder();
        }
        <span class="hljs-keyword">return</span> allRows;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            ps.close();
            conn.close();
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getIntegerFromProperties</span><span class="hljs-params">(Properties properties, String key, <span class="hljs-keyword">int</span> defaultValue)</span> </span>{
        <span class="hljs-keyword">if</span> (properties.getProperty(key) == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> defaultValue;
        }
        <span class="hljs-keyword">return</span> Integer.parseInt(properties.getProperty(key));
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkMandatoryProperties</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (table == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigurationException(<span class="hljs-string">&quot;property table not set&quot;</span>);
        }
        <span class="hljs-keyword">if</span> (connectionURL == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigurationException(<span class="hljs-string">&quot;connection.url property not set&quot;</span>);
        }
        <span class="hljs-keyword">if</span> (connectionUserName == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigurationException(<span class="hljs-string">&quot;connection.user property not set&quot;</span>);
        }
        <span class="hljs-keyword">if</span> (connectionPassword == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigurationException(<span class="hljs-string">&quot;connection.password property not set&quot;</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">InitConnection</span><span class="hljs-params">(String url, String user, String pw)</span> </span>{
        <span class="hljs-keyword">try</span> {
            Connection conn = DriverManager.getConnection(url, user, pw);
            <span class="hljs-keyword">if</span> (conn == <span class="hljs-keyword">null</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SQLException();
            <span class="hljs-keyword">return</span> conn;
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">buildQuery</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// &#x83B7;&#x53D6;&#x5F53;&#x524D;id</span>
        currentIndex = getStatusDBIndex(startFrom);
        LOG.info(currentIndex + <span class="hljs-string">&quot;&quot;</span>);

        <span class="hljs-comment">// &#x4EE5;id&#x4F5C;&#x4E3A;offset</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SELECT &quot;</span> + columnsToSelect + <span class="hljs-string">&quot; FROM &quot;</span> + table + <span class="hljs-string">&quot; where &quot;</span> +
                <span class="hljs-string">&quot;id&quot;</span> + <span class="hljs-string">&quot;&gt;&quot;</span> + currentIndex;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> Integer <span class="hljs-title">getStatusDBIndex</span><span class="hljs-params">(<span class="hljs-keyword">int</span> startFrom)</span> </span>{
        <span class="hljs-comment">// &#x4ECE; flume_meta &#x8868;&#x4E2D;&#x67E5;&#x8BE2;&#x51FA;&#x5F53;&#x524D;&#x7684;id&#xFF0C;&#x82E5;&#x6709;&#x503C;&#xFF0C;&#x4EE5;&#x6B64;&#x4E3A;&#x51C6;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x4EE5;&#x4F20;&#x5165;&#x53C2;&#x6570; startFrom &#x4E3A;&#x51C6;</span>
        String dbIndex = queryFirstColumn(<span class="hljs-string">&quot;select currentIndex from flume_meta where source_tab=&apos;&quot;</span> + table + <span class="hljs-string">&quot;&apos;&quot;</span>);
        <span class="hljs-keyword">if</span> (dbIndex != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> Integer.parseInt(dbIndex);
        }

        <span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#x6216;&#x8005;&#x6570;&#x636E;&#x8868;&#x4E2D;&#x8FD8;&#x6CA1;&#x6709;&#x5B58;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x8FD4;&#x56DE;&#x6700;&#x521D;&#x4F20;&#x5165;&#x7684;&#x503C;</span>
        <span class="hljs-keyword">return</span> startFrom;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">queryFirstColumn</span><span class="hljs-params">(String sql)</span> </span>{
        ResultSet result;
        <span class="hljs-keyword">try</span> {
            ps = conn.prepareStatement(sql);
            result = ps.executeQuery();
            <span class="hljs-keyword">while</span> (result.next()) {
                <span class="hljs-keyword">return</span> result.getString(<span class="hljs-number">1</span>);
            }
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execSql</span><span class="hljs-params">(String sql)</span> </span>{
        <span class="hljs-keyword">try</span> {
            ps = conn.prepareStatement(sql);
            ps.execute();
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRunQueryDelay</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> runQueryDelay;
    }
}
</code></pre>
<p>MySQLSource.java</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySQLSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Configurable</span>, <span class="hljs-title">PollableSource</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LoggerFactory.getLogger(MySQLSource.class);
    <span class="hljs-keyword">private</span> MySQLHelper sqlSourceHelper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getBackOffSleepIncrement</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getMaxBackOffSleepInterval</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(Context context)</span> </span>{
        <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;</span>
        sqlSourceHelper = <span class="hljs-keyword">new</span> MySQLHelper(context);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> PollableSource.<span class="hljs-function">Status <span class="hljs-title">process</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> EventDeliveryException </span>{
        <span class="hljs-keyword">try</span> {
            List&lt;Event&gt; events = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            HashMap&lt;String, String&gt; header = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

            <span class="hljs-comment">// &#x67E5;&#x8BE2;&#x6570;&#x636E;&#x8868;</span>
            List&lt;List&lt;Object&gt;&gt; result = sqlSourceHelper.executeQuery();

            <span class="hljs-comment">// &#x5982;&#x679C;&#x6709;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x5C06;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x4E3A;event</span>
            <span class="hljs-keyword">if</span> (!result.isEmpty()) {
                List&lt;String&gt; allRows = sqlSourceHelper.getAllRows(result);
                Event event;
                <span class="hljs-keyword">for</span> (String row : allRows) {
                    event = <span class="hljs-keyword">new</span> SimpleEvent();
                    event.setBody(row.getBytes());
                    event.setHeaders(header);
                    events.add(event);
                }

                <span class="hljs-comment">// &#x5C06;event&#x5199;&#x5165;channel</span>
                <span class="hljs-keyword">this</span>.getChannelProcessor().processEventBatch(events);

                <span class="hljs-comment">// &#x66F4;&#x65B0;&#x6570;&#x636E;&#x8868;&#x4E2D;&#x7684;offset&#x4FE1;&#x606F;</span>
                sqlSourceHelper.updateOffset2DB(result.size());
            }

            <span class="hljs-comment">// &#x7B49;&#x5F85;&#x65F6;&#x957F;</span>
            Thread.sleep(sqlSourceHelper.getRunQueryDelay());
            <span class="hljs-keyword">return</span> Status.READY;

        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            LOG.error(<span class="hljs-string">&quot;Error processing row&#xFF1A;&quot;</span>, e);
            <span class="hljs-keyword">return</span> Status.BACKOFF;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>{
        LOG.info(<span class="hljs-string">&quot;Stopping sql source {} ...&quot;</span>, getName());
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// &#x5173;&#x95ED;&#x8D44;&#x6E90;</span>
            sqlSourceHelper.close();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">super</span>.stop();
        }
    }
}
</code></pre>
<p>jdbc.properties</p>
<pre><code class="lang-properties">dbUrl=jdbc:mysql://node03:3306/mysqlsource?useUnicode=true&amp;characterEncoding=utf-8
dbUser=root
dbPassword=root
dbDriver=com.mysql.jdbc.Driver
</code></pre>
<h3 id="&#x4E0A;&#x4F20;jar_1"><a name="&#x4E0A;&#x4F20;jar_1" class="anchor-navigation-ex-anchor" href="#&#x4E0A;&#x4F20;jar_1"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.4. &#x4E0A;&#x4F20;jar</h3>
<pre><code class="lang-shell"># &#x81EA;&#x5B9A;&#x4E49;source &#x4E0A;&#x4F20;&#x5230; plugins.d/mysqlsource/lib
scp hadoop-flume-example-1.0-SNAPSHOT.jar hadoop@node03:/bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/plugins.d/mysqlsource/lib

# &#x5176;&#x4F9D;&#x8D56; &#x4E0A;&#x4F20;&#x5230; plugins.d/mysqlsource/libext
scp mysql-connector-java-5.1.38.jar /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/plugins.d/mysqlsource/libext
</code></pre>
<h3 id="&#x914D;&#x7F6E;_8"><a name="&#x914D;&#x7F6E;_8" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_8"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.5. &#x914D;&#x7F6E;</h3>
<p>mysqlsource.conf</p>
<pre><code class="lang-properties"># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
# &#x81EA;&#x5B9A;&#x4E49;source&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5305;&#x540D;
a1.sources.r1.type = com.sciatta.hadoop.flume.example.source.MySQLSource
a1.sources.r1.columns.to.select = *
a1.sources.r1.run.query.delay=20000
a1.sources.r1.start.from=0
a1.sources.r1.table = student

# Describe the channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Describe the sink
a1.sinks.k1.type = logger

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<h3 id="&#x542F;&#x52A8;_8"><a name="&#x542F;&#x52A8;_8" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_8"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.6. &#x542F;&#x52A8;</h3>
<pre><code class="lang-shell">flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f mysqlsource.conf -Dflume.root.logger=DEBUG,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_7"><a name="&#x6D4B;&#x8BD5;_7" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_7"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.7. &#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-mysql">-- &#x63D2;&#x5165;3&#x6761;&#x6570;&#x636E;&#xFF0C;offset&#x66F4;&#x65B0;&#x4E3A;7
insert into mysqlsource.student(name) values (&apos;rain&apos;);
insert into mysqlsource.student(name) values (&apos;yoyo&apos;);
insert into mysqlsource.student(name) values (&apos;lucky&apos;);

-- &#x63D2;&#x5165;2&#x6761;&#x6570;&#x636E;&#xFF0C;offset&#x66F4;&#x65B0;&#x4E3A;9
insert into mysqlsource.student(name) values (&apos;1&apos;);
insert into mysqlsource.student(name) values (&apos;2&apos;);
</code></pre>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;sink"><a name="&#x81EA;&#x5B9A;&#x4E49;sink" class="anchor-navigation-ex-anchor" href="#&#x81EA;&#x5B9A;&#x4E49;sink"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. &#x81EA;&#x5B9A;&#x4E49;Sink</h2>
<h3 id="&#x9700;&#x6C42;_2"><a name="&#x9700;&#x6C42;_2" class="anchor-navigation-ex-anchor" href="#&#x9700;&#x6C42;_2"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.1. &#x9700;&#x6C42;</h3>
<p>&#x81EA;&#x5B9A;&#x4E49;flume&#x7684;sink&#xFF0C;&#x5B9E;&#x73B0;&#x5C06;&#x6570;&#x636E;&#x8FC7;&#x6EE4;&#x5904;&#x7406;&#x540E;&#x5199;&#x5165;&#x5230;mysql&#x6570;&#x636E;&#x5E93;&#x3002;</p>
<h3 id="&#x51C6;&#x5907;&#x6570;&#x636E;_2"><a name="&#x51C6;&#x5907;&#x6570;&#x636E;_2" class="anchor-navigation-ex-anchor" href="#&#x51C6;&#x5907;&#x6570;&#x636E;_2"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.2. &#x51C6;&#x5907;&#x6570;&#x636E;</h3>
<pre><code class="lang-mysql">drop table if exists mysqlsource.flume2mysql;
CREATE TABLE mysqlsource.flume2mysql (
  id INT(11) NOT NULL AUTO_INCREMENT,
  createTime VARCHAR(64) NOT NULL,
  content VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=INNODB DEFAULT CHARSET=utf8;
</code></pre>
<h3 id="&#x5F00;&#x53D1;_2"><a name="&#x5F00;&#x53D1;_2" class="anchor-navigation-ex-anchor" href="#&#x5F00;&#x53D1;_2"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.3. &#x5F00;&#x53D1;</h3>
<p>MySQLSink.java</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySQLSink</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSink</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Configurable</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LoggerFactory.getLogger(MySQLSink.class);

    <span class="hljs-keyword">private</span> String connectionURL = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">private</span> String connectionUserName = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">private</span> String connectionPassword = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">private</span> String tableName = <span class="hljs-string">&quot;&quot;</span>;

    Connection con = <span class="hljs-keyword">null</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(Context context)</span> </span>{
        Properties p = <span class="hljs-keyword">new</span> Properties();
        <span class="hljs-keyword">try</span> {
            p.load(MySQLHelper.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;jdbc.properties&quot;</span>));

            <span class="hljs-comment">// &#x4ECE;properties&#x4E2D;&#x83B7;&#x5F97;</span>
            connectionURL = p.getProperty(<span class="hljs-string">&quot;dbUrl&quot;</span>);
            connectionUserName = p.getProperty(<span class="hljs-string">&quot;dbUser&quot;</span>);
            connectionPassword = p.getProperty(<span class="hljs-string">&quot;dbPassword&quot;</span>);

            <span class="hljs-comment">// &#x4ECE;flume&#x914D;&#x7F6E;&#x4E2D;&#x83B7;&#x5F97;</span>
            tableName = context.getString(<span class="hljs-string">&quot;table&quot;</span>);

            <span class="hljs-comment">// &#x52A0;&#x8F7D;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;</span>
            Class.forName(p.getProperty(<span class="hljs-string">&quot;dbDriver&quot;</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            LOG.error(e.toString());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            con = DriverManager.getConnection(connectionURL, connectionUserName, connectionPassword);
            <span class="hljs-keyword">super</span>.start();
            LOG.info(<span class="hljs-string">&quot;start ok! connection=&quot;</span> + con);
        } <span class="hljs-keyword">catch</span> (Exception ex) {
            ex.printStackTrace();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            con.close();
            LOG.info(<span class="hljs-string">&quot;stop ok!&quot;</span>);
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">super</span>.stop();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Status <span class="hljs-title">process</span><span class="hljs-params">()</span> </span>{
        Status status;

        <span class="hljs-comment">// Start transaction</span>
        Channel ch = getChannel();
        Transaction txn = ch.getTransaction();
        txn.begin();
        <span class="hljs-keyword">try</span> {
            Event event = ch.take();

            <span class="hljs-keyword">if</span> (event != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x83B7;&#x53D6;body&#x4E2D;&#x7684;&#x6570;&#x636E;</span>
                String body = <span class="hljs-keyword">new</span> String(event.getBody(), StandardCharsets.UTF_8);

                <span class="hljs-comment">// &#x5982;&#x679C;&#x65E5;&#x5FD7;&#x4E2D;&#x6709;&#x4EE5;&#x4E0B;&#x5173;&#x952E;&#x5B57;&#x7684;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#xFF0C;&#x8FC7;&#x6EE4;&#x6389;</span>
                <span class="hljs-keyword">if</span> (body.contains(<span class="hljs-string">&quot;delete&quot;</span>) || body.contains(<span class="hljs-string">&quot;drop&quot;</span>) || body.contains(<span class="hljs-string">&quot;alert&quot;</span>)) {
                    status = Status.BACKOFF;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// &#x5B58;&#x5165;Mysql</span>
                    SimpleDateFormat df = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);
                    String date = df.format(<span class="hljs-keyword">new</span> Date());

                    String sql = String.format(<span class="hljs-string">&quot;insert into %s (createTime, content) values (?, ?)&quot;</span>, tableName);

                    PreparedStatement stmt = con.prepareStatement(sql);
                    stmt.setString(<span class="hljs-number">1</span>, date);
                    stmt.setString(<span class="hljs-number">2</span>, body);
                    stmt.execute();
                    stmt.close();

                    status = Status.READY;
                }
            } <span class="hljs-keyword">else</span> {
                status = Status.BACKOFF;
            }

            txn.commit();
        } <span class="hljs-keyword">catch</span> (Throwable t) {
            txn.rollback();
            t.getCause().printStackTrace();
            status = Status.BACKOFF;
        } <span class="hljs-keyword">finally</span> {
            txn.close();
        }

        <span class="hljs-keyword">return</span> status;
    }

}
</code></pre>
<h3 id="&#x4E0A;&#x4F20;jar_2"><a name="&#x4E0A;&#x4F20;jar_2" class="anchor-navigation-ex-anchor" href="#&#x4E0A;&#x4F20;jar_2"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.4. &#x4E0A;&#x4F20;jar</h3>
<pre><code class="lang-shell"># &#x81EA;&#x5B9A;&#x4E49; sink &#x4E0A;&#x4F20;&#x5230; plugins.d/mysqlsource/lib
scp hadoop-flume-example-1.0-SNAPSHOT.jar hadoop@node03:/bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/plugins.d/mysqlsource/lib

# &#x5176;&#x4F9D;&#x8D56; &#x4E0A;&#x4F20;&#x5230; plugins.d/mysqlsource/libext
scp mysql-connector-java-5.1.38.jar /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/plugins.d/mysqlsource/libext
</code></pre>
<h3 id="&#x914D;&#x7F6E;_9"><a name="&#x914D;&#x7F6E;_9" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;_9"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.5. &#x914D;&#x7F6E;</h3>
<p>mysqlsink.conf</p>
<pre><code class="lang-properties">a1.sources = r1
a1.sinks = k1
a1.channels = c1

# &#x914D;&#x7F6E;source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /home/hadoop/flumedatas/taillog/access_log
a1.sources.r1.channels = c1

# &#x914D;&#x7F6E;channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# &#x914D;&#x7F6E;sink
a1.sinks.k1.channel = c1
# &#x81EA;&#x5B9A;&#x4E49;sink&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5305;&#x540D;
a1.sinks.k1.type = com.sciatta.hadoop.flume.example.sink.MySQLSink
a1.sinks.k1.table=flume2mysql
</code></pre>
<h3 id="&#x542F;&#x52A8;_9"><a name="&#x542F;&#x52A8;_9" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;_9"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.6. &#x542F;&#x52A8;</h3>
<pre><code class="lang-shell">flume-ng agent -n a1 -c /bigdata/install/apache-flume-1.6.0-cdh5.14.2-bin/conf -f mysqlsink.conf -Dflume.root.logger=DEBUG,console
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;_8"><a name="&#x6D4B;&#x8BD5;_8" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;_8"><i class="fa fa-link" aria-hidden="true"></i></a>5.3.7. &#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-shell">echo &quot;hello&quot; &gt;&gt; /home/hadoop/flumedatas/taillog/access_log
echo &quot;flume&quot; &gt;&gt; /home/hadoop/flumedatas/taillog/access_log
</code></pre>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; sciatta.com 2020 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;: 
2020-12-24 23:50:06
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Flume安装部署.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Flume安装部署">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Flume数据采集","level":"1.3.5.1.2","depth":4,"next":{"title":"Sqoop","level":"1.3.5.2","depth":3,"ref":"","articles":[{"title":"Sqoop安装部署","level":"1.3.5.2.1","depth":4,"path":"src/bigdata/auxiliaryframework/sqoop/Sqoop安装部署.md","ref":"src/bigdata/auxiliaryframework/sqoop/Sqoop安装部署.md","articles":[]},{"title":"Sqoop数据迁移","level":"1.3.5.2.2","depth":4,"path":"src/bigdata/auxiliaryframework/sqoop/Sqoop数据迁移.md","ref":"src/bigdata/auxiliaryframework/sqoop/Sqoop数据迁移.md","articles":[]}]},"previous":{"title":"Flume安装部署","level":"1.3.5.1.1","depth":4,"path":"src/bigdata/auxiliaryframework/flume/Flume安装部署.md","ref":"src/bigdata/auxiliaryframework/flume/Flume安装部署.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["hide-element","expandable-chapters","code","splitter","-lunr","-search","search-pro","pageview-count","tbfed-pagefooter","popup","auto-scroll-table","-sharing","github","github-buttons","ga","baidu-v3","donate","anchors","anchor-navigation-ex","sitemap"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy sciatta.com 2020","modify_label":"修订时间: ","modify_format":"YYYY-MM-DD HH:mm:ss"},"github":{"url":"https://github.com/sciatta"},"splitter":{},"search-pro":{},"auto-scroll-table":{},"popup":{},"code":{"copyButtons":true},"donate":{"alipay":"/develop-stack/assets/alipay.jpg","alipayText":" ","button":"捐赠","title":"","wechat":"/develop-stack/assets/wechat.jpg","wechatText":" "},"baidu-v3":{},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":false,"float":{"floatIcon":"fa fa-navicon","level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"sitemap":{"hostname":"http://www.sciatta.com/"},"pageview-count":{},"github-buttons":{"buttons":[{"user":"sciatta","repo":"develop-stack","type":"star","count":true,"size":"small"}]},"ga":{"configuration":"auto","token":"UA-156491400-1"},"baidu":{"token":"c6612709c010da681bbd4b785968a638"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"src/bigdata/auxiliaryframework/flume/Flume数据采集.md","mtime":"2020-12-24T15:50:06.226Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-29T13:50:17.892Z"},"basePath":"../../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../../gitbook/gitbook.js"></script>
    <script src="../../../../gitbook/theme.js"></script>
    
        
        <script src="../../../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-baidu-v3/baidu-tongji.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

